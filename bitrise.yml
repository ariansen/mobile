format_version: 1.2.0
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git

title: Template configuration.
summary: |-
  Template 'bitrise.yml', generated by 'bitrise init'.
description: |-
  Configuration (environments) specified in 'app' will be available
    for every workflow.

  The Trigger Map ('trigger_map') defines mapping between trigger patterns
    and workflows.
  You can run workflows directly with bitrise: bitrise run workflow-name
    Or you can 'trigger' a build: bitrise trigger some-pattern

   With this example 'trigger_map' if you 'bitrise trigger test'
    or 'bitrise trigger test-1' or specify any other pattern
    which starts with 'test' then the 'test' workflow will be used.
   In any other case (ex: 'bitrise trigger something-else') the
    workflow called 'fallback' will be used.

  Workflows ('workflows') are where you can define different, separate scenarios,
    which you can then 'bitrise run' or 'bitrise trigger'.

app:
  envs:
  - BITRISE_APP_TITLE: "Toggl"
  - BITRISE_DEV_BRANCH: "unidirectional"  
  - BITRISE_UNITEST_PROJECT_PATH: Mobile.UnitTest.sln   
  - BITRISE_PROJECT_PATH: Mobile.sln
    opts:
      is_expand: false
  - BITRISE_XAMARIN_CONFIGURATION: Debug
    opts:
      is_expand: false
  - BITRISE_XAMARIN_PLATFORM: Any CPU
    opts:
      is_expand: false   
  - NUNIT_PATH: packages/NUnit.ConsoleRunner.3.2.0/tools/  

trigger_map:
- pattern: android**
  is_pull_request_allowed: true
  workflow: android
- pattern: test**
  is_pull_request_allowed: true
  workflow: test
- pattern: "*"
  is_pull_request_allowed: true
  workflow: fallback

workflows:
  android:
    description: |-
      Workflow to run Android release
    steps:
    - script:
        title: Replace secrets
        inputs:
        - content: |-
            #!/bin/bash            
            node build-android-secrets.js
    - nuget-restore: {}
    - xamarin-builder:
        inputs:
        - platform_filter: android
    - sign-apk@0.9.6:
        inputs:
        - jarsigner_options: "-keypass $BITRISEIO_ANDROID_KEYSTORE_PRIVATE_KEY_PASSWORD"
    envs:
    - opts:
        is_expand: true
      BITRISE_XAMARIN_CONFIGURATION: Release   
  test:
    description: |-
      Workflow to run UnitTests
    steps:
    - nuget-restore@0.9.1: {}
    - nunit-runner@0.9.2:
        inputs:
        - xamarin_solution: "$BITRISE_UNITEST_PROJECT_PATH"
        - nunit_options: ''
  fallback:
    description: |-
      This is a fallback workflow. As defined in the 'trigger_map' section
      this workflow will be selected in any case if you run 'bitrise trigger'
      with any pattern which does not match any other in
      the 'tigger_map' definition. For example 'bitrise trigger my-custom-pattern'
      or 'bitrise trigger my/custom/pattern' will both select this workflow.
    steps:
    - script:
        title: Fallback
        inputs:
        - content: |-
            #!/bin/bash
            echo "This is a the fallback workflow, used"
            echo " if you 'bitrise trigger' a build but the pattern"
            echo " does not match any other pattern in the trigger_map"
